#!/bin/bash
whois "$1" | awk -F': ' 'BEGIN{split("Registrant,Admin,Tech",ss,","); split("Name,Organization,Street,City,State/Province,Postal Code,Country,Phone,Phone Ext:,Fax,Fax Ext:,Email",ff,",")} {k=$1; v=$2; sub(/^[ \t]+/,"",k); sub(/[ \t]+$/,"",k); a[k]=v} END{for(i=1;i<=3;i++)for(j=1;j<=12;j++){k=ss[i]" "ff[j]; v=a[k]; if(ff[j]=="Street" && v!="")v=v" "; if(ff[j]~/Ext:/)v=""; row=ss[i]" "ff[j]","v; out=(out==""?row:out"\n"row)} printf "%s", out}' > "$1.csv
